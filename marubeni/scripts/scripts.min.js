"use strict";

function addArticleSocials() {
    var e = createShareElement({
        url: location.href
    });
    e.className = "socials", article.appendChild(e)
}

function becauseEverybodyLovesAutoplay() {
    var e = Utilities.querySelectorArray('aside iframe[src*="vimeo"]');
    e.forEach(function(e) {
        return initVimeoPlayer(e).then(function() {
            for (var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = t.player, i = e.parentNode; i.parentNode && "ASIDE" !== i.tagName;) i = i.parentNode;
            i && ! function() {
                var t = !1,
                    a = !1;
                n.on("play", function() {
                    Utilities.addClass(i, "playing"), t = !0, a = !1
                }), n.on("pause", function() {
                    Utilities.removeClass(i, "playing"), t = !1, a = !1
                }), i.addEventListener("click", function(e) {
                    e.target === i && (e.preventDefault(), n.play())
                }), onSCROLL.addHandler(function() {
                    if (!a) {
                        var i = Utilities.inViewport(e);
                        i && !t ? (a = !0, n.play()) : !i && t && (a = !0, n.pause())
                    }
                })
            }()
        })
    })
}

function addArticleLinks() {
    var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : article;
    Utilities.querySelectorArray("a", e).forEach(function(e) {
        var t = e.getAttribute("href"),
            n = pages.find(function(e) {
                return "#" + e.href.split(".")[0] === t
            });
        n ? (n = n.href.split(".")[0], e.addEventListener("click", function(e) {
            e.preventDefault(), Utilities.scrollTo({
                y: article.offsetTop + 60
            }), currentPage !== t ? loadPage(n) : Utilities.addClass(container, "navigation-closed")
        })) : 0 === t.indexOf("http") && e.setAttribute("target", "_blank")
    })
}

function loadPage(e) {
    "#" !== e && (location.hash = e.replace(".html", ""), Utilities.addClass(container, "navigation-loading"), Utilities.XMLHttpRequest(e, function(t) {
        currentPage = e;
        var n = document.createElement("document");
        n.innerHTML = t, article.innerHTML = n.querySelector("article").innerHTML, Utilities.removeClass(container, "navigation-loading"), Utilities.addClass(container, "navigation-closed"), addArticleResizeHandlers(), addArticleSocials(), addArticleLinks(), becauseEverybodyLovesAutoplay()
    }, function() {
        console.log("Error loading url: " + e), Utilities.removeClass(container, "navigation-loading")
    }))
}
var onSCROLL = new EventThrottler(document, "scroll"),
    onRESIZE = new EventThrottler(window, "resize"),
    currentPage = "#",    
    scrollBody = Utilities.scrollBodyElement();
onSCROLL.addHandler(function() {
    var e = !1;
}()), document.addEventListener("DOMContentLoaded", function() {
    becauseEverybodyLovesAutoplay();
});
